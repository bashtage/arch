

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>arch.bootstrap.base &#8212; arch 4.8.1+28.g7afac85 documentation</title>
    <link rel="stylesheet" href="../../../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  
  
   

  <link rel="stylesheet" href="../../../_static/css/overrides.css" type="text/css" />

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">arch 4.8.1+28.g7afac85 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../../../index.html" class="text-logo">arch 4.8.1 (+28)</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../univariate/univariate.html">Univariate Volatility Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bootstrap/bootstrap.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../multiple-comparison/multiple-comparisons.html">Multiple Comparison Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unitroot/unitroot.html">Unit Root Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes.html">Change Log</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../../../index.html">Docs</a></li>
              
                <li><a href="../../index.html">Module code</a></li>
              
              <li>arch.bootstrap.base</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <h1>Source code for arch.bootstrap.base</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">arch.compat.python</span> <span class="k">import</span> <span class="n">add_metaclass</span><span class="p">,</span> <span class="n">iteritems</span><span class="p">,</span> <span class="n">itervalues</span><span class="p">,</span> <span class="nb">range</span>

<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="k">import</span> <span class="n">RandomState</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>

<span class="kn">from</span> <span class="nn">arch.utility.array</span> <span class="k">import</span> <span class="n">DocStringInheritor</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;IIDBootstrap&#39;</span><span class="p">,</span> <span class="s1">&#39;StationaryBootstrap&#39;</span><span class="p">,</span> <span class="s1">&#39;CircularBlockBootstrap&#39;</span><span class="p">,</span>
           <span class="s1">&#39;MovingBlockBootstrap&#39;</span><span class="p">,</span> <span class="s1">&#39;IndependentSamplesBootstrap&#39;</span><span class="p">]</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">arch.bootstrap._samplers</span> <span class="k">import</span> <span class="n">stationary_bootstrap_sample</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="kn">from</span> <span class="nn">arch.bootstrap._samplers_python</span> <span class="k">import</span> <span class="n">stationary_bootstrap_sample</span>


<span class="k">def</span> <span class="nf">_get_acceleration</span><span class="p">(</span><span class="n">jk_params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimates the BCa acceleration parameter using jackknife estimates</span>
<span class="sd">    of theta.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    jk_params : ndarray</span>
<span class="sd">        Array containing the jackknife results where row i corresponds to</span>
<span class="sd">        leaving observation i out of the sample. Returned by _loo_jackknife.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : float</span>
<span class="sd">        Value of the acceleration parameter &quot;a&quot; used in the BCa bootstrap.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">jk_params</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">jk_params</span>
    <span class="n">numer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span>
    <span class="n">small</span> <span class="o">=</span> <span class="n">denom</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numer</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">small</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Jackknife variance estimate </span><span class="si">{jk_var}</span><span class="s1"> is &#39;</span> \
                    <span class="s1">&#39;too small to use BCa&#39;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jk_var</span><span class="o">=</span><span class="n">denom</span><span class="p">))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">numer</span> <span class="o">/</span> <span class="n">denom</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_loo_jackknife</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Leave one out jackknife estimation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : callable</span>
<span class="sd">        Function that computes parameters.  Called using func(*args, **kwargs)</span>
<span class="sd">    nobs : int</span>
<span class="sd">        Number of observation in the data</span>
<span class="sd">    args : list</span>
<span class="sd">        List of positional inputs (arrays, Series or DataFrames)</span>
<span class="sd">    kwargs : dict</span>
<span class="sd">        List of keyword inputs (arrays, Series or DataFrames)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    results : ndarray</span>
<span class="sd">        Array containing the jackknife results where row i corresponds to</span>
<span class="sd">        leaving observation i out of the sample</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nobs</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">nobs</span><span class="p">]</span>
        <span class="n">args_copy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
                <span class="n">args_copy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">items</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args_copy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">items</span><span class="p">])</span>
        <span class="n">kwargs_copy</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
                <span class="n">kwargs_copy</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">items</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kwargs_copy</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">items</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args_copy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_copy</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_add_extra_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Safely add additional keyword arguments to an existing dictionary</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kwargs : dict</span>
<span class="sd">        Keyword argument dictionary</span>
<span class="sd">    extra_kwargs : dict, optional</span>
<span class="sd">        Keyword argument dictionary to add</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    augmented_kwargs : dict</span>
<span class="sd">        Keyword dictionary with added keyword arguments</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    There is no checking for duplicate keys</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">extra_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">kwargs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">extra_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


<div class="viewcode-block" id="IIDBootstrap"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IIDBootstrap">[docs]</a><span class="nd">@add_metaclass</span><span class="p">(</span><span class="n">DocStringInheritor</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">IIDBootstrap</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bootstrap using uniform resampling</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args</span>
<span class="sd">        Positional arguments to bootstrap</span>
<span class="sd">    kwargs</span>
<span class="sd">        Keyword arguments to bootstrap</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    index : ndarray</span>
<span class="sd">        The current index of the bootstrap</span>
<span class="sd">    data : tuple</span>
<span class="sd">        Two-element tuple with the pos_data in the first position and kw_data</span>
<span class="sd">        in the second (pos_data, kw_data)</span>
<span class="sd">    pos_data : tuple</span>
<span class="sd">        Tuple containing the positional arguments (in the order entered)</span>
<span class="sd">    kw_data : dict</span>
<span class="sd">        Dictionary containing the keyword arguments</span>
<span class="sd">    random_state : RandomState</span>
<span class="sd">        RandomState instance used by bootstrap</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Supports numpy arrays and pandas Series and DataFrames.  Data returned has</span>
<span class="sd">    the same type as the input date.</span>

<span class="sd">    Data entered using keyword arguments is directly accessibly as an</span>
<span class="sd">    attribute.</span>

<span class="sd">    To ensure a reproducible bootstrap, you must set the ``random_state``</span>
<span class="sd">    attribute after the bootstrap has been created. See the example below.</span>
<span class="sd">    Note that ``random_state`` is a reserved keyword and any variable</span>
<span class="sd">    passed using this keyword must be an instance of ``RandomState``.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Data can be accessed in a number of ways.  Positional data is retained in</span>
<span class="sd">    the same order as it was entered when the bootstrap was initialized.</span>
<span class="sd">    Keyword data is available both as an attribute or using a dictionary syntax</span>
<span class="sd">    on kw_data.</span>

<span class="sd">    &gt;&gt;&gt; from arch.bootstrap import IIDBootstrap</span>
<span class="sd">    &gt;&gt;&gt; from numpy.random import standard_normal</span>
<span class="sd">    &gt;&gt;&gt; y = standard_normal((500, 1))</span>
<span class="sd">    &gt;&gt;&gt; x = standard_normal((500,2))</span>
<span class="sd">    &gt;&gt;&gt; z = standard_normal(500)</span>
<span class="sd">    &gt;&gt;&gt; bs = IIDBootstrap(x, y=y, z=z)</span>
<span class="sd">    &gt;&gt;&gt; for data in bs.bootstrap(100):</span>
<span class="sd">    ...     bs_x = data[0][0]</span>
<span class="sd">    ...     bs_y = data[1][&#39;y&#39;]</span>
<span class="sd">    ...     bs_z = bs.z</span>

<span class="sd">    Set the random_state if reproducibility is required</span>

<span class="sd">    &gt;&gt;&gt; from numpy.random import RandomState</span>
<span class="sd">    &gt;&gt;&gt; rs = RandomState(1234)</span>
<span class="sd">    &gt;&gt;&gt; bs = IIDBootstrap(x, y=y, z=z, random_state=rs)</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    arch.bootstrap.IndependentSamplesBootstrap</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_common_size_required</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;random_state&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span> <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">RandomState</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="n">all_args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">all_args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">itervalues</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_size_required</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">all_args</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All inputs must have the same number of &quot;</span>
                                     <span class="s2">&quot;elements in axis 0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_data</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kw_data</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_base</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_studentized_results</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_func</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;IID Bootstrap&#39;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39; is a reserved name&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;(no. pos. inputs: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_data</span><span class="p">))</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;, no. keyword inputs: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kw_data</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">txt</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, ID: &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

    <span class="k">def</span> <span class="nf">_repr_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;strong&gt;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/strong&gt;(&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;strong&gt;no. pos. inputs&lt;/strong&gt;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_data</span><span class="p">))</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;, &lt;strong&gt;no. keyword inputs&lt;/strong&gt;: &#39;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kw_data</span><span class="p">))</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;, &lt;strong&gt;ID&lt;/strong&gt;: &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">html</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">random_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set or get the instance random state&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span>

    <span class="nd">@random_state</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">random_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">RandomState</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Value being set must be a RandomState&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current index of the bootstrap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span>

<div class="viewcode-block" id="IIDBootstrap.get_state"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IIDBootstrap.get_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the state of the bootstrap&#39;s random number generator</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        state : RandomState state vector</span>
<span class="sd">            Array containing the state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span></div>

<div class="viewcode-block" id="IIDBootstrap.set_state"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IIDBootstrap.set_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the state of the bootstrap&#39;s random number generator</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        state : RandomState state vector</span>
<span class="sd">            Array containing the state</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="IIDBootstrap.seed"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IIDBootstrap.seed">[docs]</a>    <span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Seeds the bootstrap&#39;s random number generator</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int</span>
<span class="sd">            Integer to use as the seed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="IIDBootstrap.reset"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IIDBootstrap.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_seed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the bootstrap to either its initial state or the last seed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        use_seed : bool, optional</span>
<span class="sd">            Flag indicating whether to use the last seed if provided.  If</span>
<span class="sd">            False or if no seed has been set, the bootstrap will be reset</span>
<span class="sd">            to the initial state.  Default is True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resample</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initial_state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_seed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seed</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="IIDBootstrap.bootstrap"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IIDBootstrap.bootstrap">[docs]</a>    <span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterator for use when bootstrapping</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reps : int</span>
<span class="sd">            Number of bootstrap replications</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gen : generator</span>
<span class="sd">            Generator to iterate over in bootstrap calculations</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        The key steps are problem dependent and so this example shows the use</span>
<span class="sd">        as an iterator that does not produce any output</span>

<span class="sd">        &gt;&gt;&gt; from arch.bootstrap import IIDBootstrap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; bs = IIDBootstrap(np.arange(100), x=np.random.randn(100))</span>
<span class="sd">        &gt;&gt;&gt; for posdata, kwdata in bs.bootstrap(1000):</span>
<span class="sd">        ...     # Do something with the positional data and/or keyword data</span>
<span class="sd">        ...     pass</span>

<span class="sd">        .. note::</span>

<span class="sd">            Note this is a generic example and so the class used should be the</span>
<span class="sd">            name of the required bootstrap</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The iterator returns a tuple containing the data entered in positional</span>
<span class="sd">        arguments as a tuple and the data entered using keywords as a</span>
<span class="sd">        dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_indices</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resample</span><span class="p">()</span></div>

<div class="viewcode-block" id="IIDBootstrap.conf_int"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IIDBootstrap.conf_int">[docs]</a>    <span class="k">def</span> <span class="nf">conf_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">tail</span><span class="o">=</span><span class="s1">&#39;two&#39;</span><span class="p">,</span>
                 <span class="n">extra_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reuse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sampling</span><span class="o">=</span><span class="s1">&#39;nonparametric&#39;</span><span class="p">,</span>
                 <span class="n">std_err_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">studentize_reps</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            Function the computes parameter values.  See Notes for requirements</span>
<span class="sd">        reps : int, optional</span>
<span class="sd">            Number of bootstrap replications</span>
<span class="sd">        method : string, optional</span>
<span class="sd">            One of &#39;basic&#39;, &#39;percentile&#39;, &#39;studentized&#39;, &#39;norm&#39; (identical to</span>
<span class="sd">            &#39;var&#39;, &#39;cov&#39;), &#39;bc&#39; (identical to &#39;debiased&#39;, &#39;bias-corrected&#39;), or</span>
<span class="sd">            &#39;bca&#39;</span>
<span class="sd">        size : float, optional</span>
<span class="sd">            Coverage of confidence interval</span>
<span class="sd">        tail : string, optional</span>
<span class="sd">            One of &#39;two&#39;, &#39;upper&#39; or &#39;lower&#39;.</span>
<span class="sd">        reuse : bool, optional</span>
<span class="sd">            Flag indicating whether to reuse previously computed bootstrap</span>
<span class="sd">            results.  This allows alternative methods to be compared without</span>
<span class="sd">            rerunning the bootstrap simulation.  Reuse is ignored if reps is</span>
<span class="sd">            not the same across multiple runs, func changes across calls, or</span>
<span class="sd">            method is &#39;studentized&#39;.</span>
<span class="sd">        sampling : string, optional</span>
<span class="sd">            Type of sampling to use: &#39;nonparametric&#39;, &#39;semi-parametric&#39; (or</span>
<span class="sd">            &#39;semi&#39;) or &#39;parametric&#39;.  The default is &#39;nonparametric&#39;.  See</span>
<span class="sd">            notes about the changes to func required when using &#39;semi&#39; or</span>
<span class="sd">            &#39;parametric&#39;.</span>
<span class="sd">        extra_kwargs : dict, optional</span>
<span class="sd">            Extra keyword arguments to use when calling func and std_err_func,</span>
<span class="sd">            when appropriate</span>
<span class="sd">        std_err_func : callable, optional</span>
<span class="sd">            Function to use when standardizing estimated parameters when using</span>
<span class="sd">            the studentized bootstrap.  Providing an analytical function</span>
<span class="sd">            eliminates the need for a nested bootstrap</span>
<span class="sd">        studentize_reps : int, optional</span>
<span class="sd">            Number of bootstraps to use in the inner bootstrap when using the</span>
<span class="sd">            studentized bootstrap.  Ignored when ``std_err_func`` is provided</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        intervals : 2-d array</span>
<span class="sd">            Computed confidence interval.  Row 0 contains the lower bounds, and</span>
<span class="sd">            row 1 contains the upper bounds.  Each column corresponds to a</span>
<span class="sd">            parameter. When tail is &#39;lower&#39;, all upper bounds are inf.</span>
<span class="sd">            Similarly, &#39;upper&#39; sets all lower bounds to -inf.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; def func(x):</span>
<span class="sd">        ...     return x.mean(0)</span>
<span class="sd">        &gt;&gt;&gt; y = np.random.randn(1000, 2)</span>
<span class="sd">        &gt;&gt;&gt; from arch.bootstrap import IIDBootstrap</span>
<span class="sd">        &gt;&gt;&gt; bs = IIDBootstrap(y)</span>
<span class="sd">        &gt;&gt;&gt; ci = bs.conf_int(func, 1000)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        When there are no extra keyword arguments, the function is called</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            func(*args, **kwargs)</span>

<span class="sd">        where args and kwargs are the bootstrap version of the data provided</span>
<span class="sd">        when setting up the bootstrap.  When extra keyword arguments are used,</span>
<span class="sd">        these are appended to kwargs before calling func.</span>

<span class="sd">        The standard error function, if provided, must return a vector of</span>
<span class="sd">        parameter standard errors and is called</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            std_err_func(params, *args, **kwargs)</span>

<span class="sd">        where ``params`` is the vector of estimated parameters using the same</span>
<span class="sd">        bootstrap data as in args and kwargs.</span>

<span class="sd">        The bootstraps are:</span>

<span class="sd">        * &#39;basic&#39; - Basic confidence using the estimated parameter and</span>
<span class="sd">          difference between the estimated parameter and the bootstrap</span>
<span class="sd">          parameters</span>
<span class="sd">        * &#39;percentile&#39; - Direct use of bootstrap percentiles</span>
<span class="sd">        * &#39;norm&#39; - Makes use of normal approximation and bootstrap covariance</span>
<span class="sd">          estimator</span>
<span class="sd">        * &#39;studentized&#39; - Uses either a standard error function or a nested</span>
<span class="sd">          bootstrap to estimate percentiles and the bootstrap covariance for</span>
<span class="sd">          scale</span>
<span class="sd">        * &#39;bc&#39; - Bias corrected using estimate bootstrap bias correction</span>
<span class="sd">        * &#39;bca&#39; - Bias corrected and accelerated, adding acceleration parameter</span>
<span class="sd">          to &#39;bc&#39; method</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">studentized</span> <span class="o">=</span> <span class="s1">&#39;studentized&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;size must be strictly between 0 and 1&#39;</span><span class="p">)</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="n">tail</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tail</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;tail must be one of two-sided, lower or upper&#39;</span><span class="p">)</span>
        <span class="n">studentize_reps</span> <span class="o">=</span> <span class="n">studentize_reps</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="n">studentized</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="n">_reuse</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">reuse</span><span class="p">:</span>
            <span class="c1"># check conditions for reuse</span>
            <span class="n">_reuse</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                      <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">)</span> <span class="o">==</span> <span class="n">reps</span> <span class="ow">and</span>
                      <span class="n">method</span> <span class="o">!=</span> <span class="n">studentized</span> <span class="ow">and</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">_last_func</span> <span class="ow">is</span> <span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_reuse</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reuse</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">warnings</span>

                <span class="n">warn</span> <span class="o">=</span> <span class="s1">&#39;The conditions to reuse the previous bootstrap has &#39;</span> \
                       <span class="s1">&#39;not been satisfied. A new bootstrap will be used.&#39;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warn</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_construct_bootstrap_estimates</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">reps</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="p">,</span>
                                                <span class="n">std_err_func</span><span class="o">=</span><span class="n">std_err_func</span><span class="p">,</span>
                                                <span class="n">studentize_reps</span><span class="o">=</span><span class="n">studentize_reps</span><span class="p">,</span>  <span class="c1"># noqa</span>
                                                <span class="n">sampling</span><span class="o">=</span><span class="n">sampling</span><span class="p">)</span>

        <span class="n">base</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>
        <span class="n">studentized_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_studentized_results</span>

        <span class="n">std_err</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;cov&#39;</span><span class="p">,</span> <span class="n">studentized</span><span class="p">):</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">results</span> <span class="o">-</span> <span class="n">results</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">std_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">/</span> <span class="n">reps</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">tail</span> <span class="o">==</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">size</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">size</span><span class="p">)</span>

        <span class="n">percentiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">alpha</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">]</span>
        <span class="n">norm_quantiles</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">percentiles</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;cov&#39;</span><span class="p">):</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">norm_quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">std_err</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">norm_quantiles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">std_err</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="s1">&#39;basic&#39;</span><span class="p">,</span> <span class="n">studentized</span><span class="p">,</span>
                        <span class="s1">&#39;debiased&#39;</span><span class="p">,</span> <span class="s1">&#39;bc&#39;</span><span class="p">,</span> <span class="s1">&#39;bias-corrected&#39;</span><span class="p">,</span> <span class="s1">&#39;bca&#39;</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">results</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="n">studentized</span><span class="p">:</span>
                <span class="c1"># studentized uses studentized parameter estimates</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">studentized_results</span>

            <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;debiased&#39;</span><span class="p">,</span> <span class="s1">&#39;bc&#39;</span><span class="p">,</span> <span class="s1">&#39;bias-corrected&#39;</span><span class="p">,</span> <span class="s1">&#39;bca&#39;</span><span class="p">):</span>
                <span class="c1"># bias corrected uses modified percentiles, but is</span>
                <span class="c1"># otherwise identical to the percentile method</span>
                <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bca_bias</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;bca&#39;</span><span class="p">:</span>
                    <span class="n">lens</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">]</span> <span class="o">+</span> \
                           <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">kwarg</span><span class="p">)</span> <span class="k">for</span> <span class="n">kwarg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">lens</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lens</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;BCa cannot be applied to statistics &#39;</span>
                                         <span class="s1">&#39;computed from datasets with &#39;</span>
                                         <span class="s1">&#39;different lengths&#39;</span><span class="p">)</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bca_acceleration</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">percentiles</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">norm_quantiles</span><span class="p">)</span> <span class="o">/</span>
                                             <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">norm_quantiles</span><span class="p">)))</span>
                <span class="n">percentiles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">percentiles</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">percentiles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span> <span class="o">*</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">percentiles</span><span class="p">]</span>  <span class="c1"># Rescale</span>

            <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;bc&#39;</span><span class="p">,</span> <span class="s1">&#39;debiased&#39;</span><span class="p">,</span> <span class="s1">&#39;bias-corrected&#39;</span><span class="p">,</span> <span class="s1">&#39;bca&#39;</span><span class="p">):</span>
                <span class="n">ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">lower</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">upper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">values</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span>
                                                       <span class="nb">list</span><span class="p">(</span><span class="n">percentiles</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

            <span class="c1"># Basic and studentized use the lower empirical quantile to</span>
            <span class="c1"># compute upper and vice versa.  Bias corrected and percentile use</span>
            <span class="c1"># upper to estimate the upper, and lower to estimate the lower</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;basic&#39;</span><span class="p">:</span>
                <span class="n">lower_copy</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="mf">0.0</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">base</span> <span class="o">-</span> <span class="n">upper</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">base</span> <span class="o">-</span> <span class="n">lower_copy</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="n">studentized</span><span class="p">:</span>
                <span class="n">lower_copy</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="mf">0.0</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="n">base</span> <span class="o">-</span> <span class="n">upper</span> <span class="o">*</span> <span class="n">std_err</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="n">base</span> <span class="o">-</span> <span class="n">lower_copy</span> <span class="o">*</span> <span class="n">std_err</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown method&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tail</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
            <span class="n">upper</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tail</span> <span class="o">==</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
            <span class="n">lower</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_bca_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">b</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_bca_acceleration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span>
        <span class="n">jk_params</span> <span class="o">=</span> <span class="n">_loo_jackknife</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_get_acceleration</span><span class="p">(</span><span class="n">jk_params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clones the bootstrap using different data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args</span>
<span class="sd">            Positional arguments to bootstrap</span>
<span class="sd">        kwargs</span>
<span class="sd">            Keyword arguments to bootstrap</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bs</span>
<span class="sd">            Bootstrap instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos_arguments</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">)</span>
        <span class="n">pos_arguments</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">bs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="n">pos_arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bs</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bs</span>

<div class="viewcode-block" id="IIDBootstrap.apply"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IIDBootstrap.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies a function to bootstrap replicated data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            Function the computes parameter values.  See Notes for requirements</span>
<span class="sd">        reps : int, optional</span>
<span class="sd">            Number of bootstrap replications</span>
<span class="sd">        extra_kwargs : dict, optional</span>
<span class="sd">            Extra keyword arguments to use when calling func.  Must not</span>
<span class="sd">            conflict with keyword arguments used to initialize bootstrap</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : ndarray</span>
<span class="sd">            reps by nparam array of computed function values where each row</span>
<span class="sd">            corresponds to a bootstrap iteration</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        When there are no extra keyword arguments, the function is called</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            func(params, *args, **kwargs)</span>

<span class="sd">        where args and kwargs are the bootstrap version of the data provided</span>
<span class="sd">        when setting up the bootstrap.  When extra keyword arguments are used,</span>
<span class="sd">        these are appended to kwargs before calling func</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; x = np.random.randn(1000,2)</span>
<span class="sd">        &gt;&gt;&gt; from arch.bootstrap import IIDBootstrap</span>
<span class="sd">        &gt;&gt;&gt; bs = IIDBootstrap(x)</span>
<span class="sd">        &gt;&gt;&gt; def func(y):</span>
<span class="sd">        ...     return y.mean(0)</span>
<span class="sd">        &gt;&gt;&gt; results = bs.apply(func, 100)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_add_extra_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num_params</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">num_params</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">reps</span><span class="p">,</span> <span class="n">num_params</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">pos_data</span><span class="p">,</span> <span class="n">kw_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">reps</span><span class="p">):</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_add_extra_kwargs</span><span class="p">(</span><span class="n">kw_data</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">pos_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">results</span></div>

    <span class="k">def</span> <span class="nf">_construct_bootstrap_estimates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">reps</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">std_err_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">studentize_reps</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                       <span class="n">sampling</span><span class="o">=</span><span class="s1">&#39;nonparametric&#39;</span><span class="p">):</span>
        <span class="c1"># Private, more complicated version of apply</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="n">semi</span> <span class="o">=</span> <span class="n">parametric</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">sampling</span> <span class="o">==</span> <span class="s1">&#39;parametric&#39;</span><span class="p">:</span>
            <span class="n">parametric</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">sampling</span> <span class="o">==</span> <span class="s1">&#39;semiparametric&#39;</span><span class="p">:</span>
            <span class="n">semi</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">extra_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">extra_kwargs</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;extra_kwargs contains keys used for variable&#39;</span>
                                 <span class="s1">&#39; names in the bootstrap&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_add_extra_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">num_params</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="k">else</span> <span class="n">base</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">reps</span><span class="p">,</span> <span class="n">num_params</span><span class="p">))</span>
        <span class="n">studentized_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">reps</span><span class="p">,</span> <span class="n">num_params</span><span class="p">))</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">pos_data</span><span class="p">,</span> <span class="n">kw_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">reps</span><span class="p">):</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_add_extra_kwargs</span><span class="p">(</span><span class="n">kw_data</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parametric</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span>
            <span class="k">elif</span> <span class="n">semi</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span>
            <span class="n">results</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">pos_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">std_err_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">std_err</span> <span class="o">=</span> <span class="n">std_err_func</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="o">*</span><span class="n">pos_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">studentized_results</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">-</span> <span class="n">base</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_err</span>
            <span class="k">elif</span> <span class="n">studentize_reps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Need new bootstrap of same type</span>
                <span class="n">nested_bs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="o">*</span><span class="n">pos_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_data</span><span class="p">)</span>
                <span class="c1"># Set the seed to ensure reproducibility</span>
                <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">31</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">nested_bs</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
                <span class="n">cov</span> <span class="o">=</span> <span class="n">nested_bs</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">studentize_reps</span><span class="p">,</span>
                                    <span class="n">extra_kwargs</span><span class="o">=</span><span class="n">extra_kwargs</span><span class="p">)</span>
                <span class="n">std_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cov</span><span class="p">))</span>
                <span class="n">studentized_results</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">-</span> <span class="n">base</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_err</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_studentized_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">studentized_results</span><span class="p">)</span>

<div class="viewcode-block" id="IIDBootstrap.cov"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IIDBootstrap.cov">[docs]</a>    <span class="k">def</span> <span class="nf">cov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">recenter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute parameter covariance using bootstrap</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            Callable function that returns the statistic of interest as a</span>
<span class="sd">            1-d array</span>
<span class="sd">        reps : int, optional</span>
<span class="sd">            Number of bootstrap replications</span>
<span class="sd">        recenter : bool, optional</span>
<span class="sd">            Whether to center the bootstrap variance estimator on the average</span>
<span class="sd">            of the bootstrap samples (True) or to center on the original sample</span>
<span class="sd">            estimate (False).  Default is True.</span>
<span class="sd">        extra_kwargs : dict, optional</span>
<span class="sd">            Dictionary of extra keyword arguments to pass to func</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cov: ndarray</span>
<span class="sd">            Bootstrap covariance estimator</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        func must have the signature</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            func(params, *args, **kwargs)</span>

<span class="sd">        where params are a 1-dimensional array, and `*args` and `**kwargs` are</span>
<span class="sd">        data used in the the bootstrap.  The first argument, params, will be</span>
<span class="sd">        none when called using the original data, and will contain the estimate</span>
<span class="sd">        computed using the original data in bootstrap replications.  This</span>
<span class="sd">        parameter is passed to allow parametric bootstrap simulation.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        Bootstrap covariance of the mean</span>

<span class="sd">        &gt;&gt;&gt; from arch.bootstrap import IIDBootstrap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; def func(x):</span>
<span class="sd">        ...     return x.mean(axis=0)</span>
<span class="sd">        &gt;&gt;&gt; y = np.random.randn(1000, 3)</span>
<span class="sd">        &gt;&gt;&gt; bs = IIDBootstrap(y)</span>
<span class="sd">        &gt;&gt;&gt; cov = bs.cov(func, 1000)</span>

<span class="sd">        Bootstrap covariance using a function that takes additional input</span>

<span class="sd">        &gt;&gt;&gt; def func(x, stat=&#39;mean&#39;):</span>
<span class="sd">        ...     if stat==&#39;mean&#39;:</span>
<span class="sd">        ...         return x.mean(axis=0)</span>
<span class="sd">        ...     elif stat==&#39;var&#39;:</span>
<span class="sd">        ...         return x.var(axis=0)</span>
<span class="sd">        &gt;&gt;&gt; cov = bs.cov(func, 1000, extra_kwargs={&#39;stat&#39;:&#39;var&#39;})</span>

<span class="sd">        .. note::</span>

<span class="sd">            Note this is a generic example and so the class used should be the</span>
<span class="sd">            name of the required bootstrap</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_construct_bootstrap_estimates</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">reps</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="p">)</span>
        <span class="n">base</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>

        <span class="k">if</span> <span class="n">recenter</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">results</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">results</span> <span class="o">-</span> <span class="n">base</span>

        <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">/</span> <span class="n">reps</span></div>

<div class="viewcode-block" id="IIDBootstrap.var"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IIDBootstrap.var">[docs]</a>    <span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">recenter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute parameter variance using bootstrap</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            Callable function that returns the statistic of interest as a</span>
<span class="sd">            1-d array</span>
<span class="sd">        reps : int, optional</span>
<span class="sd">            Number of bootstrap replications</span>
<span class="sd">        recenter : bool, optional</span>
<span class="sd">            Whether to center the bootstrap variance estimator on the average</span>
<span class="sd">            of the bootstrap samples (True) or to center on the original sample</span>
<span class="sd">            estimate (False).  Default is True.</span>
<span class="sd">        extra_kwargs: dict, optional</span>
<span class="sd">            Dictionary of extra keyword arguments to pass to func</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        var : ndarray</span>
<span class="sd">            Bootstrap variance estimator</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        func must have the signature</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            func(params, *args, **kwargs)</span>

<span class="sd">        where params are a 1-dimensional array, and `*args` and `**kwargs` are</span>
<span class="sd">        data used in the the bootstrap.  The first argument, params, will be</span>
<span class="sd">        none when called using the original data, and will contain the estimate</span>
<span class="sd">        computed using the original data in bootstrap replications.  This</span>
<span class="sd">        parameter is passed to allow parametric bootstrap simulation.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        Bootstrap covariance of the mean</span>

<span class="sd">        &gt;&gt;&gt; from arch.bootstrap import IIDBootstrap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; def func(x):</span>
<span class="sd">        ...     return x.mean(axis=0)</span>
<span class="sd">        &gt;&gt;&gt; y = np.random.randn(1000, 3)</span>
<span class="sd">        &gt;&gt;&gt; bs = IIDBootstrap(y)</span>
<span class="sd">        &gt;&gt;&gt; variances = bs.var(func, 1000)</span>

<span class="sd">        Bootstrap covariance using a function that takes additional input</span>

<span class="sd">        &gt;&gt;&gt; def func(x, stat=&#39;mean&#39;):</span>
<span class="sd">        ...     if stat==&#39;mean&#39;:</span>
<span class="sd">        ...         return x.mean(axis=0)</span>
<span class="sd">        ...     elif stat==&#39;var&#39;:</span>
<span class="sd">        ...         return x.var(axis=0)</span>
<span class="sd">        &gt;&gt;&gt; variances = bs.var(func, 1000, extra_kwargs={&#39;stat&#39;: &#39;var&#39;})</span>

<span class="sd">        .. note::</span>

<span class="sd">            Note this is a generic example and so the class used should be the</span>
<span class="sd">            name of the required bootstrap</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_construct_bootstrap_estimates</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">reps</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="p">)</span>
        <span class="n">base</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>

        <span class="k">if</span> <span class="n">recenter</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">results</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">results</span> <span class="o">-</span> <span class="n">base</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">errors</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">reps</span></div>

    <span class="k">def</span> <span class="nf">update_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update indices for the next iteration of the bootstrap.  This must</span>
<span class="sd">        be overridden when creating new bootstraps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">,</span>
                                          <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resample all data using the values in _index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span>
        <span class="n">pos_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
                <span class="n">pos_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pos_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
        <span class="n">named_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
                <span class="n">named_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">named_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">named_data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pos_data</span> <span class="o">=</span> <span class="n">pos_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kw_data</span> <span class="o">=</span> <span class="n">named_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_data</span><span class="p">,</span> <span class="n">named_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span></div>


<div class="viewcode-block" id="IndependentSamplesBootstrap"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IndependentSamplesBootstrap">[docs]</a><span class="k">class</span> <span class="nc">IndependentSamplesBootstrap</span><span class="p">(</span><span class="n">IIDBootstrap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bootstrap the independently resamples each input</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args</span>
<span class="sd">        Positional arguments to bootstrap</span>
<span class="sd">    kwargs</span>
<span class="sd">        Keyword arguments to bootstrap</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    index : ndarray</span>
<span class="sd">        The current index of the bootstrap</span>
<span class="sd">    data : tuple</span>
<span class="sd">        Two-element tuple with the pos_data in the first position and kw_data</span>
<span class="sd">        in the second (pos_data, kw_data)</span>
<span class="sd">    pos_data : tuple</span>
<span class="sd">        Tuple containing the positional arguments (in the order entered)</span>
<span class="sd">    kw_data : dict</span>
<span class="sd">        Dictionary containing the keyword arguments</span>
<span class="sd">    random_state : RandomState</span>
<span class="sd">        RandomState instance used by bootstrap</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This bootstrap independently resamples each input and so is only</span>
<span class="sd">    appropriate when the inputs are independent. This structure allows</span>
<span class="sd">    bootstrapping statistics that depend on samples with unequal length, as</span>
<span class="sd">    is common in some experiments. If data have cross-sectional dependence, so</span>
<span class="sd">    that observation ``i`` is related across all inputs, this bootstrap is</span>
<span class="sd">    inappropriate.</span>

<span class="sd">    Supports numpy arrays and pandas Series and DataFrames.  Data returned has</span>
<span class="sd">    the same type as the input date.</span>

<span class="sd">    Data entered using keyword arguments is directly accessibly as an</span>
<span class="sd">    attribute.</span>

<span class="sd">    To ensure a reproducible bootstrap, you must set the ``random_state``</span>
<span class="sd">    attribute after the bootstrap has been created. See the example below.</span>
<span class="sd">    Note that ``random_state`` is a reserved keyword and any variable</span>
<span class="sd">    passed using this keyword must be an instance of ``RandomState``.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Data can be accessed in a number of ways.  Positional data is retained in</span>
<span class="sd">    the same order as it was entered when the bootstrap was initialized.</span>
<span class="sd">    Keyword data is available both as an attribute or using a dictionary syntax</span>
<span class="sd">    on kw_data.</span>

<span class="sd">    &gt;&gt;&gt; from arch.bootstrap import IndependentSamplesBootstrap</span>
<span class="sd">    &gt;&gt;&gt; from numpy.random import standard_normal</span>
<span class="sd">    &gt;&gt;&gt; y = standard_normal(500)</span>
<span class="sd">    &gt;&gt;&gt; x = standard_normal(200)</span>
<span class="sd">    &gt;&gt;&gt; z = standard_normal(2000)</span>
<span class="sd">    &gt;&gt;&gt; bs = IndependentSamplesBootstrap(x, y=y, z=z)</span>
<span class="sd">    &gt;&gt;&gt; for data in bs.bootstrap(100):</span>
<span class="sd">    ...     bs_x = data[0][0]</span>
<span class="sd">    ...     bs_y = data[1][&#39;y&#39;]</span>
<span class="sd">    ...     bs_z = bs.z</span>

<span class="sd">    Set the random_state if reproducibility is required</span>

<span class="sd">    &gt;&gt;&gt; from numpy.random import RandomState</span>
<span class="sd">    &gt;&gt;&gt; rs = RandomState(1234)</span>
<span class="sd">    &gt;&gt;&gt; bs = IndependentSamplesBootstrap(x, y=y, z=z, random_state=rs)</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    arch.bootstrap.IIDBootstrap</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_common_size_required</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IndependentSamplesBootstrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;Heterogeneous IID Bootstrap&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_arg_items</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_kw_items</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">update_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update indices for the next iteration of the bootstrap.  This must</span>
<span class="sd">        be overridden when creating new bootstraps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">randint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span><span class="o">.</span><span class="n">randint</span>
        <span class="n">pos_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_arg_items</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_arg_items</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_args</span><span class="p">)]</span>
        <span class="n">kw_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_kw_items</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_kw_items</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                      <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">pos_indices</span><span class="p">,</span> <span class="n">kw_indices</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current index of the bootstrap</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        index : tuple[list[ndarray], dict[str, ndarray]]</span>
<span class="sd">            2-element tuple containing a list and a dictionary. The list</span>
<span class="sd">            contains indices for each of the positional arguments.  The</span>
<span class="sd">            dictionary contains the indices of keyword arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span>

<div class="viewcode-block" id="IndependentSamplesBootstrap.reset"><a class="viewcode-back" href="../../../bootstrap/iid-bootstraps.html#arch.bootstrap.IndependentSamplesBootstrap.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_seed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the bootstrap to either its initial state or the last seed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        use_seed : bool, optional</span>
<span class="sd">            Flag indicating whether to use the last seed if provided.  If</span>
<span class="sd">            False or if no seed has been set, the bootstrap will be reset</span>
<span class="sd">            to the initial state.  Default is True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_arg_items</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_args</span><span class="p">)]</span>
        <span class="n">kw_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_kw_items</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">pos_indices</span><span class="p">,</span> <span class="n">kw_indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resample</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initial_state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_seed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seed</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_resample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resample all data using the values in _index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos_indices</span><span class="p">,</span> <span class="n">kw_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span>
        <span class="n">pos_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
                <span class="n">pos_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">pos_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pos_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">pos_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="n">named_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
                <span class="n">named_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">kw_indices</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">named_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">kw_indices</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">named_data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pos_data</span> <span class="o">=</span> <span class="n">pos_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kw_data</span> <span class="o">=</span> <span class="n">named_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_data</span><span class="p">,</span> <span class="n">named_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span></div>


<div class="viewcode-block" id="CircularBlockBootstrap"><a class="viewcode-back" href="../../../bootstrap/timeseries-bootstraps.html#arch.bootstrap.CircularBlockBootstrap">[docs]</a><span class="k">class</span> <span class="nc">CircularBlockBootstrap</span><span class="p">(</span><span class="n">IIDBootstrap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bootstrap based on blocks of the same length with end-to-start wrap around</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    block_size : int</span>
<span class="sd">        Size of block to use</span>
<span class="sd">    args</span>
<span class="sd">        Positional arguments to bootstrap</span>
<span class="sd">    kwargs</span>
<span class="sd">        Keyword arguments to bootstrap</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    index : ndarray</span>
<span class="sd">        The current index of the bootstrap</span>
<span class="sd">    data : tuple</span>
<span class="sd">        Two-element tuple with the pos_data in the first position and kw_data</span>
<span class="sd">        in the second (pos_data, kw_data)</span>
<span class="sd">    pos_data : tuple</span>
<span class="sd">        Tuple containing the positional arguments (in the order entered)</span>
<span class="sd">    kw_data : dict</span>
<span class="sd">        Dictionary containing the keyword arguments</span>
<span class="sd">    random_state : RandomState</span>
<span class="sd">        RandomState instance used by bootstrap</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Supports numpy arrays and pandas Series and DataFrames.  Data returned has</span>
<span class="sd">    the same type as the input date.</span>

<span class="sd">    Data entered using keyword arguments is directly accessibly as an</span>
<span class="sd">    attribute.</span>

<span class="sd">    To ensure a reproducible bootstrap, you must set the ``random_state``</span>
<span class="sd">    attribute after the bootstrap has been created. See the example below.</span>
<span class="sd">    Note that ``random_state`` is a reserved keyword and any variable</span>
<span class="sd">    passed using this keyword must be an instance of ``RandomState``.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Data can be accessed in a number of ways.  Positional data is retained in</span>
<span class="sd">    the same order as it was entered when the bootstrap was initialized.</span>
<span class="sd">    Keyword data is available both as an attribute or using a dictionary syntax</span>
<span class="sd">    on kw_data.</span>

<span class="sd">    &gt;&gt;&gt; from arch.bootstrap import CircularBlockBootstrap</span>
<span class="sd">    &gt;&gt;&gt; from numpy.random import standard_normal</span>
<span class="sd">    &gt;&gt;&gt; y = standard_normal((500, 1))</span>
<span class="sd">    &gt;&gt;&gt; x = standard_normal((500, 2))</span>
<span class="sd">    &gt;&gt;&gt; z = standard_normal(500)</span>
<span class="sd">    &gt;&gt;&gt; bs = CircularBlockBootstrap(17, x, y=y, z=z)</span>
<span class="sd">    &gt;&gt;&gt; for data in bs.bootstrap(100):</span>
<span class="sd">    ...     bs_x = data[0][0]</span>
<span class="sd">    ...     bs_y = data[1][&#39;y&#39;]</span>
<span class="sd">    ...     bs_z = bs.z</span>

<span class="sd">    Set the random_state if reproducibility is required</span>

<span class="sd">    &gt;&gt;&gt; from numpy.random import RandomState</span>
<span class="sd">    &gt;&gt;&gt; rs = RandomState(1234)</span>
<span class="sd">    &gt;&gt;&gt; bs = CircularBlockBootstrap(17, x, y=y, z=z, random_state=rs)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CircularBlockBootstrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="n">block_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">block_size</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;Circular Block Bootstrap&#39;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;(block size: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;, no. pos. inputs: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_data</span><span class="p">))</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;, no. keyword inputs: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kw_data</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">txt</span>

    <span class="k">def</span> <span class="nf">_repr_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;strong&gt;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/strong&gt;(&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;strong&gt;block size&lt;/strong&gt;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;, &lt;strong&gt;no. pos. inputs&lt;/strong&gt;: &#39;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_data</span><span class="p">))</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;, &lt;strong&gt;no. keyword inputs&lt;/strong&gt;: &#39;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kw_data</span><span class="p">))</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;, &lt;strong&gt;ID&lt;/strong&gt;: &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">html</span>

    <span class="k">def</span> <span class="nf">update_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">num_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span>
        <span class="k">if</span> <span class="n">num_blocks</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">:</span>
            <span class="n">num_blocks</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_blocks</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">indices</span> <span class="o">%=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span>

        <span class="k">if</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">indices</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">indices</span></div>


<div class="viewcode-block" id="StationaryBootstrap"><a class="viewcode-back" href="../../../bootstrap/timeseries-bootstraps.html#arch.bootstrap.StationaryBootstrap">[docs]</a><span class="k">class</span> <span class="nc">StationaryBootstrap</span><span class="p">(</span><span class="n">CircularBlockBootstrap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Politis and Romano (1994) bootstrap with expon. distributed block sizes</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    block_size : int</span>
<span class="sd">        Average size of block to use</span>
<span class="sd">    args</span>
<span class="sd">        Positional arguments to bootstrap</span>
<span class="sd">    kwargs</span>
<span class="sd">        Keyword arguments to bootstrap</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    index : ndarray</span>
<span class="sd">        The current index of the bootstrap</span>
<span class="sd">    data : tuple</span>
<span class="sd">        Two-element tuple with the pos_data in the first position and kw_data</span>
<span class="sd">        in the second (pos_data, kw_data)</span>
<span class="sd">    pos_data : tuple</span>
<span class="sd">        Tuple containing the positional arguments (in the order entered)</span>
<span class="sd">    kw_data : dict</span>
<span class="sd">        Dictionary containing the keyword arguments</span>
<span class="sd">    random_state : RandomState</span>
<span class="sd">        RandomState instance used by bootstrap</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Supports numpy arrays and pandas Series and DataFrames.  Data returned has</span>
<span class="sd">    the same type as the input date.</span>

<span class="sd">    Data entered using keyword arguments is directly accessibly as an</span>
<span class="sd">    attribute.</span>

<span class="sd">    To ensure a reproducible bootstrap, you must set the ``random_state``</span>
<span class="sd">    attribute after the bootstrap has been created. See the example below.</span>
<span class="sd">    Note that ``random_state`` is a reserved keyword and any variable</span>
<span class="sd">    passed using this keyword must be an instance of ``RandomState``.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Data can be accessed in a number of ways.  Positional data is retained in</span>
<span class="sd">    the same order as it was entered when the bootstrap was initialized.</span>
<span class="sd">    Keyword data is available both as an attribute or using a dictionary syntax</span>
<span class="sd">    on kw_data.</span>

<span class="sd">    &gt;&gt;&gt; from arch.bootstrap import StationaryBootstrap</span>
<span class="sd">    &gt;&gt;&gt; from numpy.random import standard_normal</span>
<span class="sd">    &gt;&gt;&gt; y = standard_normal((500, 1))</span>
<span class="sd">    &gt;&gt;&gt; x = standard_normal((500,2))</span>
<span class="sd">    &gt;&gt;&gt; z = standard_normal(500)</span>
<span class="sd">    &gt;&gt;&gt; bs = StationaryBootstrap(12, x, y=y, z=z)</span>
<span class="sd">    &gt;&gt;&gt; for data in bs.bootstrap(100):</span>
<span class="sd">    ...     bs_x = data[0][0]</span>
<span class="sd">    ...     bs_y = data[1][&#39;y&#39;]</span>
<span class="sd">    ...     bs_z = bs.z</span>

<span class="sd">    Set the random_state if reproducibility is required</span>

<span class="sd">    &gt;&gt;&gt; from numpy.random import RandomState</span>
<span class="sd">    &gt;&gt;&gt; rs = RandomState(1234)</span>
<span class="sd">    &gt;&gt;&gt; bs = StationaryBootstrap(12, x, y=y, z=z, random_state=rs)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StationaryBootstrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">block_size</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;Stationary Bootstrap&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">block_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;Stationary Bootstrap&#39;</span>

    <span class="k">def</span> <span class="nf">update_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">,</span>
                                            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stationary_bootstrap_sample</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovingBlockBootstrap"><a class="viewcode-back" href="../../../bootstrap/timeseries-bootstraps.html#arch.bootstrap.MovingBlockBootstrap">[docs]</a><span class="k">class</span> <span class="nc">MovingBlockBootstrap</span><span class="p">(</span><span class="n">CircularBlockBootstrap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bootstrap based on blocks of the same length without wrap around</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    block_size : int</span>
<span class="sd">        Size of block to use</span>
<span class="sd">    args</span>
<span class="sd">        Positional arguments to bootstrap</span>
<span class="sd">    kwargs</span>
<span class="sd">        Keyword arguments to bootstrap</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    index : ndarray</span>
<span class="sd">        The current index of the bootstrap</span>
<span class="sd">    data : tuple</span>
<span class="sd">        Two-element tuple with the pos_data in the first position and kw_data</span>
<span class="sd">        in the second (pos_data, kw_data)</span>
<span class="sd">    pos_data : tuple</span>
<span class="sd">        Tuple containing the positional arguments (in the order entered)</span>
<span class="sd">    kw_data : dict</span>
<span class="sd">        Dictionary containing the keyword arguments</span>
<span class="sd">    random_state : RandomState</span>
<span class="sd">        RandomState instance used by bootstrap</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Supports numpy arrays and pandas Series and DataFrames.  Data returned has</span>
<span class="sd">    the same type as the input date.</span>

<span class="sd">    Data entered using keyword arguments is directly accessibly as an</span>
<span class="sd">    attribute.</span>

<span class="sd">    To ensure a reproducible bootstrap, you must set the ``random_state``</span>
<span class="sd">    attribute after the bootstrap has been created. See the example below.</span>
<span class="sd">    Note that ``random_state`` is a reserved keyword and any variable</span>
<span class="sd">    passed using this keyword must be an instance of ``RandomState``.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Data can be accessed in a number of ways.  Positional data is retained in</span>
<span class="sd">    the same order as it was entered when the bootstrap was initialized.</span>
<span class="sd">    Keyword data is available both as an attribute or using a dictionary syntax</span>
<span class="sd">    on kw_data.</span>

<span class="sd">    &gt;&gt;&gt; from arch.bootstrap import MovingBlockBootstrap</span>
<span class="sd">    &gt;&gt;&gt; from numpy.random import standard_normal</span>
<span class="sd">    &gt;&gt;&gt; y = standard_normal((500, 1))</span>
<span class="sd">    &gt;&gt;&gt; x = standard_normal((500,2))</span>
<span class="sd">    &gt;&gt;&gt; z = standard_normal(500)</span>
<span class="sd">    &gt;&gt;&gt; bs = MovingBlockBootstrap(7, x, y=y, z=z)</span>
<span class="sd">    &gt;&gt;&gt; for data in bs.bootstrap(100):</span>
<span class="sd">    ...     bs_x = data[0][0]</span>
<span class="sd">    ...     bs_y = data[1][&#39;y&#39;]</span>
<span class="sd">    ...     bs_z = bs.z</span>

<span class="sd">    Set the random_state if reproducibility is required</span>

<span class="sd">    &gt;&gt;&gt; from numpy.random import RandomState</span>
<span class="sd">    &gt;&gt;&gt; rs = RandomState(1234)</span>
<span class="sd">    &gt;&gt;&gt; bs = MovingBlockBootstrap(7, x, y=y, z=z, random_state=rs)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MovingBlockBootstrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">block_size</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;Moving Block Bootstrap&#39;</span>

    <span class="k">def</span> <span class="nf">update_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">num_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span>
        <span class="k">if</span> <span class="n">num_blocks</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">:</span>
            <span class="n">num_blocks</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">max_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_index</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_blocks</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">indices</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">indices</span></div>


<span class="k">class</span> <span class="nc">MOONBootstrap</span><span class="p">(</span><span class="n">IIDBootstrap</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MOONBootstrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="n">block_size</span>

    <span class="k">def</span> <span class="nf">update_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</pre></div>

          </div>
            
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">arch 4.8.1+28.g7afac85 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../../../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2018, Kevin Sheppard. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>